#![allow(
    clippy::too_many_lines,
    reason = "Unittests can be repetitive and long, without downgrading the overall readability"
)]

use crossterm::event::{KeyCode, KeyEvent, KeyModifiers};
use ratatui::buffer::Buffer;

use crate::events::Event;

use super::run_events_in_app;

#[test]
fn returning_to_overview_tab_when_already_there_is_nop() {
    let events = vec![Event::TerminalKey(KeyEvent::new(
        KeyCode::F(1),
        KeyModifiers::empty(),
    ))];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒText & Commandsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”ŒCoAP Req & Respâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”‚                                                         â”‚â”ŒBoard Infoâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚Version: Unknown             â”‚",
        "â”ŒUser Inputâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚Board: Unknown               â”‚",
        "â”‚Type a command, for example: help, Help, ForceCmdsAvailabâ”‚â”‚                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);
}

#[test]
fn select_text_tab() {
    let events = vec![Event::TerminalKey(KeyEvent::new(
        KeyCode::F(2),
        KeyModifiers::empty(),
    ))];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒText Messagesâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”ŒUser Inputâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚Type a command, for example: help, Help, ForceCmdsAvailable                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);
}

#[test]
fn select_coap_tab() {
    let events = vec![Event::TerminalKey(KeyEvent::new(
        KeyCode::F(3),
        KeyModifiers::empty(),
    ))];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒCoAP Req & Respâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”ŒUser Inputâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚Type a command, for example: help, Help, ForceCmdsAvailable                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);
}

#[test]
fn select_commands_tab() {
    let events = vec![Event::TerminalKey(KeyEvent::new(
        KeyCode::F(4),
        KeyModifiers::empty(),
    ))];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒCommandsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”ŒUser Inputâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚Type a command, for example: help, Help, ForceCmdsAvailable                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);
}

#[test]
fn select_net_tab() {
    let events = vec![Event::TerminalKey(KeyEvent::new(
        KeyCode::F(5),
        KeyModifiers::empty(),
    ))];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒNetwork packetsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â”‚                                                                                        â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”ŒUser Inputâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚Type a command, for example: help, Help, ForceCmdsAvailable                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);
}

#[test]
fn select_help_tab() {
    let events = vec![Event::TerminalKey(KeyEvent::new(
        KeyCode::F(12),
        KeyModifiers::empty(),
    ))];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒHelpâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚Jelly ğŸª¼: The friendly Shell for RIOT OS                                                â†‘",
        "â”‚                                                                                        â–ˆ",
        "â”‚Jelly is a tool that allows you to send commands to an attached device. The commands areâ–ˆ",
        "â”‚send via slipmux and can be either plain text or CoAP based. A device is typically      â–ˆ",
        "â”‚connected via a serial (e.g. /dev/ttyUSB0) but Jelly also supports connecting via a unixâ–ˆ",
        "â”‚socket, as long as the device speaks slipmux.                                           â–ˆ",
        "â”‚                                                                                        â–ˆ",
        "â”‚Hotkeys:                                                                                â–ˆ",
        "â”‚    Mousewheel: Scroll up and down.                                                     â–ˆ",
        "â”‚    F1: Presents an overview, showing diagnostic messages next to the configuration     â•‘",
        "â”‚messages.                                                                               â•‘",
        "â”‚    F2: Shows only the diagnostic messages.                                             â•‘",
        "â”‚    F3: Shows only the configuration messages.                                          â•‘",
        "â”‚    F4: Shows only the executed Host commands.                                          â•‘",
        "â”‚    F5: This help :)                                                                    â•‘",
        "â”‚    ESC: Quit Jelly.                                                                    â•‘",
        "â”‚    RET: Send a command.                                                                â•‘",
        "â”‚    TAB: Autocomplete.                                                                  â•‘",
        "â”‚    UP: Go back in command history.                                                     â•‘",
        "â”‚    DOWN: Go forward in command history.                                                â•‘",
        "â”‚    LEFT: Move input cursor to the left.                                                â•‘",
        "â”‚    RIGHT: Move input cursor to the right.                                              â•‘",
        "â”‚    BACKSPACE: Delete a character left of the cursor.                                   â†“",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”ŒUser Inputâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚Type a command, for example: help, Help, ForceCmdsAvailable                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);
}

#[test]
fn autocomplete() {
    let events = vec![Event::TerminalKey(KeyEvent::new(
        KeyCode::Char('H'),
        KeyModifiers::empty(),
    ))];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒText & Commandsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”ŒCoAP Req & Respâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”‚                                                         â”‚â”ŒBoard Infoâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚Version: Unknown             â”‚",
        "â”ŒUser Input: Raw diagnostic commandâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚Board: Unknown               â”‚",
        "â”‚Help | Jelly Help                                        â”‚â”‚                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);

    let events = vec![
        Event::TerminalKey(KeyEvent::new(KeyCode::Char('H'), KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Tab, KeyModifiers::empty())),
    ];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒText & Commandsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”ŒCoAP Req & Respâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”‚                                                         â”‚â”ŒBoard Infoâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚Version: Unknown             â”‚",
        "â”ŒUser Input: Helpâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚Board: Unknown               â”‚",
        "â”‚Help | Jelly Help                                        â”‚â”‚                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);

    let events = vec![
        Event::TerminalKey(KeyEvent::new(KeyCode::Char('H'), KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Tab, KeyModifiers::empty())),
        // move cursor one left Hel_p
        Event::TerminalKey(KeyEvent::new(KeyCode::Left, KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty())),
        // no matter how often we hit backspace, endresult is _p, moving cursor right to p_
        Event::TerminalKey(KeyEvent::new(KeyCode::Right, KeyModifiers::empty())),
        Event::TerminalKey(KeyEvent::new(KeyCode::Backspace, KeyModifiers::empty())),
        // Input should be empty now.
    ];
    let terminal = run_events_in_app(events);

    let expected = Buffer::with_lines([
        "Overview (F1) Text (F2) CoAP (F3) Commands (F4) Net (F5) Help (F12) â”€â”€â”€â”€â”€â”€â”€Jelly ğŸª¼â”€â”€â”€â”€â”€â”€â”€",
        "â”ŒText & Commandsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”ŒCoAP Req & Respâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â”‚                             â”‚",
        "â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”‚                                                         â”‚â”ŒBoard Infoâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚Version: Unknown             â”‚",
        "â”ŒUser Inputâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚Board: Unknown               â”‚",
        "â”‚Type a command, for example: help, Help, ForceCmdsAvailabâ”‚â”‚                             â”‚",
        "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒ not connected, retrying..",
    ]);
    terminal.backend().assert_buffer(&expected);
}
